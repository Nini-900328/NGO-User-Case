<!-- ä½¿ç”¨è€…èªè³¼ç´€éŒ„é é¢ - é¡¯ç¤ºæ‰€æœ‰ç‰©è³‡æè´ˆæ­·å² -->
@model NGOPlatformWeb.Models.ViewModels.Purchase.UserPurchaseRecordsViewModel
@{
    ViewData["Title"] = "æˆ‘çš„èªè³¼ç´€éŒ„";
}

@section Styles {
    <link rel="stylesheet" href="~/css/profile/profile-shared.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/purchase/purchase-records-standalone.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/profile/profile-dark-theme.css" />
    <style>
        /* ä¿®å¾©æˆå°±å¾½ç« å€åŸŸèˆ‡èƒŒæ™¯å°æ¯”åº¦å•é¡Œï¼Œä¸¦æ·»åŠ åœ“è§’è¨­è¨ˆ */
        .achievement-badges-card,
        .activity-timeline-card {
            background: rgba(255, 255, 255, 0.95) !important;
            border: 1px solid rgba(203, 213, 225, 0.5) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
            backdrop-filter: blur(10px) !important;
            border-radius: 20px !important; /* èˆ‡é é¢å…¶ä»–å€å¡Šä¸€è‡´çš„åœ“è§’ */
        }
        
        /* è®“æˆå°±å¾½ç« æœ‰æ›´å¥½çš„è¦–è¦ºå±¤æ¬¡ */
        .badge-item.earned {
            background: rgba(254, 243, 199, 0.9) !important;
            border: 1px solid #f59e0b !important;
            backdrop-filter: blur(5px) !important;
            border-radius: 12px !important;
        }
        
        .badge-item.locked {
            background: rgba(241, 245, 249, 0.7) !important;
            border: 1px solid rgba(203, 213, 225, 0.4) !important;
            backdrop-filter: blur(5px) !important;
            border-radius: 12px !important;
        }
        
        /* ä¿®å¾©æ™‚é–“è»¸è¨­è¨ˆ - ç§»é™¤å¥‡æ€ªçš„å‚ç›´ç·šï¼Œæ”¹å–„è¦–è¦ºæ•ˆæœ */
        .timeline-container {
            position: relative !important;
        }
        
        /* éš±è—æˆ–é‡æ–°è¨­è¨ˆå‚ç›´é€£æ¥ç·š */
        .timeline-container::before {
            display: none !important; /* éš±è—å‚ç›´ç·š */
        }
        
        .timeline-item {
            background: rgba(255, 255, 255, 0.15) !important;
            border-radius: 12px !important;
            padding: 1.25rem !important;
            margin-bottom: 1rem !important;
            backdrop-filter: blur(5px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            position: relative !important;
        }
        
        /* å„ªåŒ–æ™‚é–“è»¸æ¨™è¨˜é» */
        .timeline-marker {
            width: 40px !important;
            height: 40px !important;
            border-radius: 50% !important;
            margin-right: 1rem !important;
            flex-shrink: 0 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        .timeline-marker.delivered {
            background: linear-gradient(135deg, #28a745, #20c997) !important;
        }
        
        .timeline-marker.processing {
            background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
        }
        
        .timeline-marker.donated {
            background: linear-gradient(135deg, #007bff, #0056b3) !important;
        }
        
        /* ç§»é™¤ä»»ä½•å¯èƒ½é€ æˆå‚ç›´ç·šçš„å½å…ƒç´  */
        .timeline-item::before,
        .timeline-item::after,
        .timeline-marker::before,
        .timeline-marker::after {
            display: none !important;
        }
        
        /* æ”¹å–„èªè³¼ç´€éŒ„å¡ç‰‡çš„é…è‰² - è®“å®ƒå€‘ä¸é‚£éº¼ç™½/stark */
        .donation-story-card {
            background: rgba(248, 250, 252, 0.85) !important;
            border: 1px solid rgba(203, 213, 225, 0.4) !important;
            backdrop-filter: blur(8px) !important;
        }
        
        /* ç·Šæ€¥æ´åŠ©å¡ç‰‡ - æº«æš–çš„æ©˜ç´…è‰²èª¿ */
        .donation-story-card.emergency-type {
            background: linear-gradient(135deg, rgba(254, 242, 242, 0.9) 0%, rgba(252, 231, 243, 0.85) 100%) !important;
            border-left: 4px solid #fd7e14 !important;
            border: 1px solid rgba(253, 126, 20, 0.3) !important;
        }
        
        /* çµ„åˆåŒ…å¡ç‰‡ - æ¸…çˆ½çš„è—è‰²èª¿ */
        .donation-story-card.package-type {
            background: linear-gradient(135deg, rgba(239, 246, 255, 0.9) 0%, rgba(219, 234, 254, 0.85) 100%) !important;
            border-left: 4px solid #3498db !important;
            border: 1px solid rgba(52, 152, 219, 0.3) !important;
        }
        
        /* å¡ç‰‡æ¨™é¡Œå€åŸŸ - è®“å…§å®¹å€åŸŸä¹Ÿæœ‰é¡è‰²è®ŠåŒ– */
        .donation-story-card .story-header {
            background: rgba(248, 250, 252, 0.7) !important;
            backdrop-filter: blur(5px) !important;
        }
        
        .donation-story-card.emergency-type .story-header {
            background: rgba(254, 242, 242, 0.8) !important;
        }
        
        .donation-story-card.package-type .story-header {
            background: rgba(239, 246, 255, 0.8) !important;
        }
        
        /* æ™‚é–“æ¨™è¨˜å€åŸŸ */
        .story-timeline {
            background: rgba(255, 255, 255, 0.8) !important;
            border: 1px solid rgba(203, 213, 225, 0.3) !important;
        }
        
        /* é‡‘é¡å€åŸŸ */
        .story-amount {
            background: rgba(248, 250, 252, 0.9) !important;
            border: 1px solid rgba(203, 213, 225, 0.3) !important;
        }
        
        /* åº•éƒ¨å€åŸŸ - ä¹Ÿéœ€è¦å°æ‡‰çš„é¡è‰²è®ŠåŒ– */
        .donation-story-card .impact-footer {
            background: rgba(241, 245, 249, 0.7) !important;
            border-top: 1px solid rgba(203, 213, 225, 0.4) !important;
        }
        
        .donation-story-card.emergency-type .impact-footer {
            background: rgba(254, 242, 242, 0.6) !important;
            border-top: 1px solid rgba(253, 126, 20, 0.2) !important;
        }
        
        .donation-story-card.package-type .impact-footer {
            background: rgba(239, 246, 255, 0.6) !important;
            border-top: 1px solid rgba(52, 152, 219, 0.2) !important;
        }
        
        /* ç¯©é¸æŒ‰éˆ•å€åŸŸ - ç¢ºä¿ä¸è¢«å½±éŸ¿ */
        .records-section {
            background: rgba(255, 255, 255, 0.95) !important;
        }
        
        .records-header {
            background: rgba(248, 250, 252, 0.8) !important;
        }
    </style>
}

@{
    ViewBag.BodyClass = "profile-page";
}

<div class="container py-5">
    <!-- ç¾ä»£åŒ–é é¢æ¨™é¡Œå€åŸŸ -->
    <div class="modern-header">
        <div class="header-background">
            <div class="header-pattern"></div>
        </div>
        <div class="header-content">
            <div class="breadcrumb-modern">
                <a asp-action="UserProfile" class="breadcrumb-item">
                    <i class="fas fa-user me-1"></i>å€‹äººè³‡æ–™
                </a>
                <i class="fas fa-chevron-right breadcrumb-separator"></i>
                <span class="breadcrumb-current">æ´åŠ©ç´€éŒ„</span>
            </div>
            
            <div class="header-main">
                <div class="header-text">
                    <h1 class="modern-title">
                        <span class="title-icon">
                            <i class="fas fa-hands-helping"></i>
                        </span>
                        æˆ‘çš„æ´åŠ©ç´€éŒ„
                    </h1>
                    <p class="modern-subtitle">æ„Ÿè¬æ‚¨çš„æ„›å¿ƒï¼Œæ¯ä¸€ä»½æåŠ©éƒ½åœ¨å‰µé€ å¥‡è¹Ÿ</p>
                </div>
                <div class="header-actions">
                    <a href="@Url.Action("Index", "Purchase")" class="modern-btn primary">
                        <i class="fas fa-plus"></i>
                        <span>æä¾›æ´åŠ©</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¾ä»£åŒ–çµ±è¨ˆå„€è¡¨æ¿ -->
    <div class="stats-dashboard">
        <div class="stats-grid">
            <!-- ä¸»è¦æˆå°±å¡ç‰‡ -->
            <div class="achievement-card featured">
                <div class="achievement-header">
                    <div class="achievement-icon featured-icon">
                        <i class="fas fa-medal"></i>
                    </div>
                    <div class="achievement-badge">ç¸½è¨ˆ</div>
                </div>
                <div class="achievement-content">
                    <div class="achievement-number">$@(Model.TotalDonated.ToString("N0"))</div>
                    <div class="achievement-label">æ„›å¿ƒæåŠ©</div>
                    <div class="achievement-subtitle">å·²å¹«åŠ© @(Model.Orders.Count()) å€‹å®¶åº­</div>
                </div>
                <div class="achievement-decoration">
                    <div class="decoration-circle"></div>
                    <div class="decoration-line"></div>
                </div>
            </div>
            
            <!-- æ¬¡è¦çµ±è¨ˆå¡ç‰‡ -->
            <div class="stat-card modern">
                <div class="stat-icon blue">
                    <i class="fas fa-heart-pulse"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@(Model.TotalOrders)</div>
                    <div class="stat-label">æ´åŠ©æ¬¡æ•¸</div>
                </div>
            </div>
            
            <div class="stat-card modern">
                <div class="stat-icon green">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@(Model.Orders.Sum(o => o.TotalItems))</div>
                    <div class="stat-label">æ´åŠ©ç‰©è³‡</div>
                </div>
            </div>
            
            <div class="stat-card modern">
                <div class="stat-icon orange">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@(Model.Orders.Count())</div>
                    <div class="stat-label">å—åŠ©å®¶åº­</div>
                </div>
            </div>
            
            <div class="stat-card modern">
                <div class="stat-icon purple">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number">@(Model.Orders.Any() ? (DateTime.Now - Model.Orders.OrderByDescending(o => o.OrderDate).First().OrderDate).Days : 0)</div>
                    <div class="stat-label">å¤©å‰æ´»å‹•</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ„›å¿ƒå‹•æ…‹èˆ‡æˆå°±å€åŸŸ -->
    <div class="love-activities-section" style="margin-bottom: 2rem;">
        <div class="row g-4">
            <!-- æœ€è¿‘å‹•æ…‹æ™‚é–“è»¸ -->
            <div class="col-md-7">
                <div class="activity-timeline-card">
                    <div class="timeline-header">
                        <h4 class="timeline-title">
                            <i class="fas fa-heart text-danger me-2"></i>
                            æœ€è¿‘å‹•æ…‹
                        </h4>
                        <p class="timeline-subtitle">æ‚¨çš„æ„›å¿ƒè¶³è·¡</p>
                    </div>
                    <div class="timeline-container">
                        <div class="timeline-item">
                            <div class="timeline-marker delivered">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-date">7æœˆ13æ—¥ 22:31</div>
                                <div class="timeline-action">æ‚¨çš„ç·Šæ€¥æ´åŠ©åŒ…å·²é€é”é™³å®¶</div>
                                <div class="timeline-details">åŒ…å«é†«ç™‚ç”¨å“ã€æ¸…æ½”ç”¨å“ç­‰ 8 ä»¶ç‰©è³‡</div>
                                <div class="timeline-status success">âœ“ å·²é€é”</div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-marker processing">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-date">7æœˆ13æ—¥ 18:00</div>
                                <div class="timeline-action">æ‚¨æåŠ©çš„çµ„åˆåŒ…æ­£åœ¨é…é€ä¸­</div>
                                <div class="timeline-details">é è¨ˆä»Šæ™šé€é”æ—å®¶ï¼Œæ„Ÿè¬æ‚¨çš„æ„›å¿ƒ</div>
                                <div class="timeline-status processing">ğŸšš é…é€ä¸­</div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-marker donated">
                                <i class="fas fa-gift"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-date">7æœˆ13æ—¥ 14:11</div>
                                <div class="timeline-action">æ„Ÿè¬æ‚¨æä¾›æ„›å¿ƒæåŠ©</div>
                                <div class="timeline-details">æ¸…æ½”ç”¨å“çµ„åˆ - è®“å—åŠ©å®¶åº­ä¿æŒå¥åº·è¡›ç”Ÿ</div>
                                <div class="timeline-status donated">ğŸ’ å·²æè´ˆ</div>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-marker delivered">
                                <i class="fas fa-smile"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-date">7æœˆ8æ—¥</div>
                                <div class="timeline-action">æ”¶åˆ°å—åŠ©è€…çš„æ„Ÿè¬å›é¥‹</div>
                                <div class="timeline-details">"è¬è¬æ‚¨çš„ç‰©è³‡ï¼Œè®“æˆ‘å€‘ä¸€å®¶åº¦éé›£é—œ"</div>
                                <div class="timeline-status feedback">ğŸ’Œ æ„Ÿè¬å›é¥‹</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æˆå°±å¾½ç« å€åŸŸ -->
            <div class="col-md-5">
                <div class="achievement-badges-card">
                    <div class="badges-header">
                        <h4 class="badges-title">
                            <i class="fas fa-award text-warning me-2"></i>
                            æ„›å¿ƒæˆå°±
                        </h4>
                        <p class="badges-subtitle">æ‚¨ç²å¾—çš„æ¦®è­½å¾½ç« </p>
                    </div>
                    <div class="badges-container">
                        <div class="badge-item earned">
                            <div class="badge-icon">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="badge-info">
                                <div class="badge-name">æ„›å¿ƒæ–°æ‰‹</div>
                                <div class="badge-desc">å®Œæˆé¦–æ¬¡æè´ˆ</div>
                            </div>
                            <div class="badge-date">7æœˆ5æ—¥ç²å¾—</div>
                        </div>
                        
                        <div class="badge-item earned">
                            <div class="badge-icon">
                                <i class="fas fa-hands-helping"></i>
                            </div>
                            <div class="badge-info">
                                <div class="badge-name">æŒçºŒå–„å¿ƒ</div>
                                <div class="badge-desc">é€£çºŒ3å€‹æœˆæè´ˆ</div>
                            </div>
                            <div class="badge-date">7æœˆ13æ—¥ç²å¾—</div>
                        </div>
                        
                        <div class="badge-item earned">
                            <div class="badge-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="badge-info">
                                <div class="badge-name">ç·Šæ€¥å¤©ä½¿</div>
                                <div class="badge-desc">éŸ¿æ‡‰ç·Šæ€¥æ´åŠ©</div>
                            </div>
                            <div class="badge-date">7æœˆ10æ—¥ç²å¾—</div>
                        </div>
                        
                        <div class="badge-item locked">
                            <div class="badge-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="badge-info">
                                <div class="badge-name">æ„›å¿ƒé”äºº</div>
                                <div class="badge-desc">ç´¯è¨ˆæè´ˆ10æ¬¡</div>
                            </div>
                            <div class="badge-progress">é€²åº¦: 6/10</div>
                        </div>
                        
                        <div class="badge-item locked">
                            <div class="badge-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div class="badge-info">
                                <div class="badge-name">ç¤¾å€å®ˆè­·è€…</div>
                                <div class="badge-desc">å¹«åŠ©20å€‹å®¶åº­</div>
                            </div>
                            <div class="badge-progress">é€²åº¦: 11/20</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¾ä»£åŒ–ç´€éŒ„åˆ—è¡¨ -->
    <div class="records-section">
        <div class="records-header">
            <div class="header-info">
                <h3 class="section-title">æ´åŠ©è¨˜éŒ„</h3>
                <p class="section-description">å…± @(Model.Orders.Count()) ç­†è¨˜éŒ„</p>
            </div>
            <div class="filter-controls">
                <div class="filter-tabs">
                    <button class="tab-btn active" data-filter="all">
                        <span>å…¨éƒ¨</span>
                        <span class="tab-count">@(Model.Orders.Count(o => o.IsEmergencyOrder || o.OrderSource == "package"))</span>
                    </button>
                    <button class="tab-btn" data-filter="emergency">
                        <span>ç·Šæ€¥æ´åŠ©</span>
                        <span class="tab-count">@(Model.Orders.Count(o => o.IsEmergencyOrder))</span>
                    </button>
                    <button class="tab-btn" data-filter="package">
                        <span>çµ„åˆåŒ…</span>
                        <span class="tab-count">@(Model.Orders.Count(o => o.OrderSource == "package"))</span>
                    </button>
                </div>
            </div>
        </div>

        @if (Model.Orders.Where(o => o.IsEmergencyOrder || o.OrderSource == "package").Any())
        {
            <div class="purchase-records">
                @foreach (var order in Model.Orders.Where(o => o.IsEmergencyOrder || o.OrderSource == "package"))
                {
                    <div class="donation-story-card @(order.IsEmergencyOrder ? "emergency-type" : "package-type")" 
                         data-type="@(order.IsEmergencyOrder ? "emergency" : "package")"
                         data-order-id="@order.OrderId">
                        
                        <!-- æ´åŠ©æ•…äº‹æ¨™é¡Œ -->
                        <div class="story-header">
                            <div class="story-timeline">
                                <div class="story-date">@order.OrderDate.ToString("MMæœˆddæ—¥")</div>
                                <div class="story-time">@order.OrderDate.ToString("HH:mm")</div>
                            </div>
                            <div class="story-content">
                                <div class="story-title">
                                    @if (order.IsEmergencyOrder)
                                    {
                                        <span class="story-icon emergency">ğŸš¨</span>
                                        <text>æ‚¨éŸ¿æ‡‰äº†ç·Šæ€¥æ´åŠ©å‘¼ç±²</text>
                                    }
                                    else
                                    {
                                        <span class="story-icon package">ğŸ“¦</span>
                                        <text>æ‚¨é¸æ“‡äº†çµ„åˆåŒ…æ´åŠ©æ–¹æ¡ˆ</text>
                                    }
                                </div>
                                <div class="story-description">
                                    @if (order.IsEmergencyOrder)
                                    {
                                        <text>åœ¨é—œéµæ™‚åˆ»ä¼¸å‡ºæ´æ‰‹ï¼Œç‚ºæ€¥éœ€å¹«åŠ©çš„å®¶åº­é€å»æº«æš–</text>
                                    }
                                    else
                                    {
                                        <text>é€éç²¾å¿ƒæ­é…çš„ç‰©è³‡çµ„åˆï¼Œæä¾›å…¨é¢æ€§çš„ç”Ÿæ´»æ”¯æ´</text>
                                    }
                                </div>
                            </div>
                            <div class="story-amount">
                                <div class="amount-label">æ´åŠ©é‡‘é¡</div>
                                <div class="amount-value">$@(order.TotalPrice.ToString("N0"))</div>
                                <div class="payment-info">
                                    <div class="payment-method">
                                        @{
                                            string paymentMethod = order.PaymentMethod ?? "credit_card";
                                            string paymentIcon = "";
                                            string paymentText = "";
                                            
                                            switch (paymentMethod.ToLower())
                                            {
                                                case "credit_card":
                                                    paymentIcon = "fas fa-credit-card";
                                                    paymentText = "ä¿¡ç”¨å¡";
                                                    break;
                                                case "atm":
                                                    paymentIcon = "fas fa-university";
                                                    paymentText = "ATMè½‰å¸³";
                                                    break;
                                                case "ecpay":
                                                    paymentIcon = "fas fa-mobile-alt";
                                                    paymentText = "ç¶ ç•Œæ”¯ä»˜";
                                                    break;
                                                case "line_pay":
                                                    paymentIcon = "fab fa-line";
                                                    paymentText = "LINE Pay";
                                                    break;
                                                case "apple_pay":
                                                    paymentIcon = "fab fa-apple-pay";
                                                    paymentText = "Apple Pay";
                                                    break;
                                                case "google_pay":
                                                    paymentIcon = "fab fa-google-pay";
                                                    paymentText = "Google Pay";
                                                    break;
                                                default:
                                                    paymentIcon = "fas fa-credit-card";
                                                    paymentText = "ä¿¡ç”¨å¡";
                                                    break;
                                            }
                                        }
                                        <i class="@paymentIcon"></i><span>@paymentText</span>
                                    </div>
                                    <div class="delivery-status">
                                        @{
                                            string statusIcon = "";
                                            string statusText = "";
                                            string statusClass = "";
                                            
                                            switch (order.PaymentStatus)
                                            {
                                                case "å·²ä»˜æ¬¾":
                                                    statusIcon = "âœ“";
                                                    statusText = "å·²é€é”";
                                                    statusClass = "success";
                                                    break;
                                                case "å¾…ä»˜æ¬¾":
                                                    statusIcon = "â³";
                                                    statusText = "å¾…ä»˜æ¬¾";
                                                    statusClass = "pending";
                                                    break;
                                                case "ä»˜æ¬¾å¤±æ•—":
                                                    statusIcon = "âŒ";
                                                    statusText = "ä»˜æ¬¾å¤±æ•—";
                                                    statusClass = "failed";
                                                    break;
                                                default:
                                                    statusIcon = "?";
                                                    statusText = order.PaymentStatus ?? "æœªçŸ¥";
                                                    statusClass = "unknown";
                                                    break;
                                            }
                                        }
                                        <span class="status-@statusClass">@statusIcon @statusText</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å¯å±•é–‹çš„ç‰©è³‡è©³æƒ… -->
                        <div class="story-details collapsed">
                            <div class="details-header">
                                <button class="toggle-details-btn" onclick="toggleDetails(@order.OrderId)">
                                    <span class="toggle-text">æŸ¥çœ‹æ´åŠ©è©³æƒ…</span>
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                </button>
                            </div>
                            <div class="details-content">
                                <div class="supplies-grid">
                                    @if (order.Items.Any())
                                    {
                                        @foreach (var item in order.Items)
                                        {
                                            <div class="supply-item">
                                                <div class="supply-image">
                                                    <img src="@(string.IsNullOrEmpty(item.ImageUrl) ? "/images/user-default.png" : item.ImageUrl)" 
                                                         alt="@item.SupplyName">
                                                </div>
                                                <div class="supply-info">
                                                    <div class="supply-name">@item.SupplyName</div>
                                                    <div class="supply-quantity">@item.Quantity ä»½</div>
                                                </div>
                                                <div class="supply-value">$@item.TotalPrice.ToString("N0")</div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="supply-item">
                                            <div class="supply-info">
                                                <div class="supply-name">æ´åŠ©ç‰©è³‡</div>
                                                <div class="supply-quantity">1 ä»½</div>
                                            </div>
                                            <div class="supply-value">$@order.TotalPrice.ToString("N0")</div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- å½±éŸ¿åŠ›è¶³è·¡ -->
                        <div class="impact-footer">
                            <div class="impact-stats">
                                <div class="impact-item">
                                    <span class="impact-number">@order.TotalItems</span>
                                    <span class="impact-label">ä»¶ç‰©è³‡</span>
                                </div>
                                <div class="impact-item">
                                    <span class="impact-number">1</span>
                                    <span class="impact-label">å€‹å®¶åº­</span>
                                </div>
                                <div class="impact-item">
                                    <span class="impact-number">@((DateTime.Now - order.OrderDate).Days)</span>
                                    <span class="impact-label">å¤©å‰</span>
                                </div>
                            </div>
                            <div class="quick-actions">
                                <button class="action-btn secondary" onclick="window.print()">
                                    <i class="fas fa-download"></i>
                                    <span>ä¸‹è¼‰æ”¶æ“š</span>
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <!-- ç¾ä»£åŒ–ç©ºç‹€æ…‹ -->
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h4>é‚„æ²’æœ‰èªè³¼ç´€éŒ„</h4>
                <p>
                    æ‚¨çš„æ„›å¿ƒæè´ˆèƒ½ç‚ºéœ€è¦å¹«åŠ©çš„å®¶åº­å¸¶ä¾†æº«æš–<br>
                    ä¸€èµ·åŠ å…¥æ„›å¿ƒè¡Œåˆ—ï¼Œç”¨å–„æ„é»äº®å¸Œæœ›ï¼
                </p>
                <a href="@Url.Action("Index", "Purchase")" class="btn btn-primary btn-lg">
                    <i class="fas fa-donate me-2"></i>é–‹å§‹èªè³¼
                </a>
            </div>
        }
    </div>
</div>

<!-- æ„Ÿè¬èˆ‡å½±éŸ¿åŠ›å€å¡Š -->
@if (Model.Orders.Any())
{
    <div class="container py-5">
        <div class="gratitude-section">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="gratitude-content">
                        <i class="fas fa-hands-helping gratitude-icon"></i>
                        <h3 class="gratitude-title">æ„Ÿè¬æ‚¨çš„æ„›å¿ƒ</h3>
                        <p class="gratitude-message">
                            æ‚¨çš„æ¯ä¸€ä»½æè´ˆéƒ½ç¶“éæˆ‘å€‘çš„å°ˆæ¥­é…é€ï¼Œç¢ºä¿é€é”æœ€éœ€è¦çš„å€‹æ¡ˆæ‰‹ä¸­ã€‚
                            æ‚¨çš„å–„èˆ‰ä¸åƒ…æä¾›äº†ç‰©è³ªæ”¯æ´ï¼Œæ›´æ˜¯å‚³éäº†ç¤¾æœƒçš„æº«æš–èˆ‡é—œæ‡·ã€‚
                        </p>
                        <div class="contact-info">
                            å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œæ­¡è¿éš¨æ™‚
                            <a href="@Url.Action("Contact", "Home")" class="contact-link">è¯çµ¡æˆ‘å€‘</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="impact-stats">
                        <div class="impact-item">
                            <div class="impact-number">100%</div>
                            <div class="impact-label">ç‰©è³‡é€é”ç‡</div>
                        </div>
                        <div class="impact-item">
                            <div class="impact-number">24h</div>
                            <div class="impact-label">ç·Šæ€¥æ´åŠ©å›æ‡‰</div>
                        </div>
                        <div class="impact-item">
                            <div class="impact-number">@(Model.Orders.Sum(o => o.TotalItems))+</div>
                            <div class="impact-label">æ‚¨çš„æ„›å¿ƒç‰©è³‡</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ç¯©é¸åŠŸèƒ½
            const filterTabs = document.querySelectorAll('.tab-btn');
            const storyCards = document.querySelectorAll('.donation-story-card');
            
            filterTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    filterTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.dataset.filter;
                    
                    storyCards.forEach(card => {
                        const cardType = card.dataset.type;
                        
                        if (filter === 'all') {
                            card.style.display = 'block';
                        } else if (filter === 'emergency' && cardType === 'emergency') {
                            card.style.display = 'block';
                        } else if (filter === 'package' && cardType === 'package') {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        });
        
        // å±•é–‹/æ”¶èµ·è©³æƒ…åŠŸèƒ½
        function toggleDetails(orderId) {
            const card = document.querySelector(`[data-order-id="${orderId}"]`);
            const detailsSection = card.querySelector('.story-details');
            const toggleText = card.querySelector('.toggle-text');
            
            if (detailsSection.classList.contains('collapsed')) {
                detailsSection.classList.remove('collapsed');
                toggleText.textContent = 'æ”¶èµ·è©³æƒ…';
            } else {
                detailsSection.classList.add('collapsed');
                toggleText.textContent = 'æŸ¥çœ‹æ´åŠ©è©³æƒ…';
            }
        }
    </script>
}