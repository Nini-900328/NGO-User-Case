@model List<NGOPlatformWeb.Models.Entity.Activity>

<!-- 標題與說明區塊 -->
<div class="activity-hero">
    <div class="hero-content">
        <h1>活動總覽</h1>
        <p>快找親朋好友一起參與活動吧～</p>
    </div>
</div>

<link rel="stylesheet" href="~/css/activity-overview.css" />

<div class="container">
    <div class="mb-4">
        <div class="d-flex flex-wrap justify-content-center align-items-center gap-2">
            <input type="text" class="form-control search-box" placeholder="搜尋活動名稱…" />
            <button class="btn btn-outline-success btn-filter" data-category="全部">全部</button>
            <button class="btn btn-outline-success btn-filter" data-category="生活">生活</button>
            <button class="btn btn-outline-success btn-filter" data-category="運動">運動</button>
            <button class="btn btn-outline-success btn-filter" data-category="娛樂">娛樂</button>
            <button class="btn btn-outline-success btn-filter" data-category="教育">教育</button>
            <button class="btn btn-outline-success btn-filter" data-category="心靈">心靈</button>
        </div>
    </div>

    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4 activity-card-wrapper"
                 data-category="@item.Category">
                <div class="activity-card-vertical search-card">
                    <div class="activity-img">
                        <img src="@item.ImageUrl" alt="活動圖片" />
                    </div>
                    <div class="activity-info">
                        <h3>@item.ActivityName</h3>
                        <p class="desc">@item.Description</p>
                        <p>地點：@item.Location</p>
                        <p>開始時間：@item.StartDate.ToString("yyyy/MM/dd HH:mm")</p>
                        <p>結束時間：@item.EndDate.ToString("yyyy/MM/dd HH:mm")</p>
                        <p>參與人數：@item.CurrentParticipants / @item.MaxParticipants</p>
                        <div class="activity-actions">
                            <a class="btn-join"
                               asp-controller="Activity"
                               asp-route-id="@item.ActivityId">
                                立即參與
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>


@section Scripts {
        <script>
            $(document).ready(function () {

                // 儲存目前選擇的分類 (預設全部)
                let currentCategory = "全部";

                // 函式：套用篩選邏輯
                function applyFilters() {
                    const keyword = $(".search-box").val().toLowerCase();

                    $(".activity-card-wrapper").each(function () {
                        const cardCategory = $(this).data("category"); // 從 data-category 抓分類
                        const cardText = $(this).text().toLowerCase(); // 卡片文字內容

                        // 條件1：分類
                        const matchCategory = (currentCategory === "全部" || cardCategory === currentCategory);
                        // 條件2：搜尋關鍵字
                        const matchKeyword = cardText.includes(keyword);

                        // 同時符合兩個條件才顯示
                        if (matchCategory && matchKeyword) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                }

                // 🔹 點擊篩選標籤
                $(".btn-filter").on("click", function () {
                    $(".btn-filter").removeClass("active");
                    $(this).addClass("active");
                    currentCategory = $(this).data("category"); // 更新當前選擇的分類
                    applyFilters();
                });

                // 🔎 搜尋框即時篩選
                $(".search-box").on("keyup", function () {
                    applyFilters();
                });

            });
        </script>
}

